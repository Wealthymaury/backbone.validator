/* 
 * Backbone Validator v0.5 
 * 
 * por: Mauricio Manjarrez Magallón, @wealthymaury 
 * Minified on Thu Sep 03 2015 12:37:22 
 */
window.Validator={};Validator.Lang={};Validator.Config={debug:false,lang:"es-mx"};try{_;Backbone}catch(error){throw new Error(error.message)}Validator.Lang["es-mx"]={fields:{},messages:{required:"El campo es requerido.",string:"El campo debe ser un texto.","boolean":"El campo debe ser verdadero o falso.",integer:"El campo debe ser un número.","in":"El campo debe estar en: :arg1.",not_in:"El campo :field no debe estar en: :arg1.",array:"El campo debe ser un arreglo.",min:"El campo debe ser mayor o igual a: :arg1.",minLength:"El campo debe tener una longitud mayor o igual a: :arg1.",max:"El campo debe ser menor o igual a: :arg1.",maxLength:"El campo debe tener una longitud menor o igual a: :arg1.",between:"El campo debe estar entre: :arg1 y :arg2.",betweenLength:"El campo debe tener una longitud entre: :arg1 y :arg2 caracteres.",length:"El campo debe tener una longitud igual a: :arg1.",same:"El campo :field debe ser igual al campo :field_eq.",different:"El campo :field debe ser diferente al campo :field_eq.",confirmed:"El campo debe ser confirmado correctamente.",exists:"El :field :value no existe en el registro de :collection.",unique:"El :field :value ya existe en el registro de :collection.",email:"El campo debe ser un email válido.",mimes:"El formato del archivo es inválido.",regex:"El formato del campo no es válido.",date:"El formato del campo no es válido, debe ser una fecha.",before:"La fecha debe ser anterior a :arg1.",after:"La fecha debe ser posterior a :arg1."},info:{start_validation:"Inicio de la validación para: ",end_validation:"Fin de la validacion para: ",validated:"Se validó: ",result:"Resultado: ",success:"Correcto."},validations:{invalid_field:"El campo :field no esta definido en el modelo.",invalid_collection:"La coleccion :collection no esta definida.",numeric_args:":function : Los argumentos deben ser numericos.",required_arg:":function : debes pasar al menos un parametro a la validación].",required_args:":function : debes pasar :num parametros a la validación.",invalid_rule:"La regla :rule no está definida.",except_format:"El atributo except en la regla Unique debe ser un Identificador.",invalid_date:":function : El argumento deben ser una fecha."}};var info=function(a){if(Validator.Config.debug==true){console.info(a)}};var emailValid=function(a){expr=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!expr.test(a))return false;return true};var getMessage=function(a,b){b=b.toString();var c=Validator.Config.lang;var d=Validator.Lang[c][a][b];if(b.indexOf("id")!=-1&&d==undefined){d="Identificador"}if(d==undefined){d=b.substr(0,1).toUpperCase()+b.substr(1)}return d};var arrayStringsToInts=function(a){for(var b=0;b<a.length;b++)a[b]=+a[b];return a};_.extend(Backbone.Model.prototype,{validate:function(a,b){if(this.validation==true){var c={};var d={};var e=_.map(this.validatorRules,this.makeValidation,this);if(typeof this.moreValidations=="function"){d=this.moreValidations()}if(!_.isEmpty(e)){for(var f=0;f<=e.length;f++){_.extend(c,e[f])}}if(d!==undefined){_.each(d,function(a,b,c){if(this.hasOwnProperty(b)){for(f in a){this[b].push(a[f])}}else{this[b]=a}},c)}if(!_.isEmpty(c)){info("Errores al validar: "+JSON.stringify(c));return c}}},makeValidation:function(rules,field_r,list){if(rules=="")return;var errors={};var arrRules=rules.split("|");var field="'"+field_r+"'";for(i in arrRules){var rule=arrRules[i];var parts=rule.split(":");if(typeof eval("this."+parts[0])=="undefined"){throw new SyntaxError(getMessage("validations","invalid_rule").replace(":rule",parts[0]))}var expBase=parts[0]+"(*);";var args="";if(parts[1]!==undefined){parts[1]=parts[1].replace(/,/gi,"','");args=",'"+parts[1]+"'"}args=args.replace(",''","");expBase=expBase.replace("*",field+args);var exp="this."+expBase;var error=eval(exp);if(error!==undefined){errors[field_r]=errors[field_r]||new Array;errors[field_r].push(error)}}return errors},required:function(a){if(this.get(a)===""||this.get(a)===null||this.get(a)===undefined){return getMessage("messages","required")}},string:function(a){if(typeof this.get(a)!=="string"){return getMessage("messages","string")}},integer:function(a){if(typeof this.get(a)!=="number"){return getMessage("messages","integer")}},"in":function(a){this.validateArguments(arguments,"in");var b=this.get(a);var c=this.argsWithoutFirst(arguments);var d=c.indexOf(b+"");if(d===-1){return getMessage("messages","in").replace(":arg1",c.toString().replace(",",", "))}},not_in:function(a){this.validateArguments(arguments,"not_in");var b=this.get(a);var c=this.argsWithoutFirst(arguments);var d=c.indexOf(b+"");if(d!==-1){return getMessage("messages","not_in").replace(":arg1",c.toString().replace(",",", "))}},array:function(a){if(this.get(a)instanceof Array==false){return getMessage("messages","array")}},min:function(a){this.validateArguments(arguments,"min");this.validateArgumentsNumeric(this.argsWithoutFirst(arguments),"min");if(typeof this.get(a)!=="number"||+this.get(a)<+arguments[1]){return getMessage("messages","min").replace(":arg1",arguments[1])}},minLength:function(a){this.validateArguments(arguments,"minLength");if(this.get(a).toString().length<+arguments[1]){return getMessage("messages","minLength").replace(":arg1",arguments[1])}},max:function(a){this.validateArguments(arguments,"max");this.validateArgumentsNumeric(this.argsWithoutFirst(arguments),"max");if(typeof this.get(a)!=="number"||+this.get(a)>+arguments[1]){return getMessage("messages","max").replace(":arg1",arguments[1])}},maxLength:function(a){this.validateArguments(arguments,"maxLength");if(this.get(a).toString().length>+arguments[1]){return getMessage("messages","maxLength").replace(":arg1",arguments[1])}},between:function(a){this.validateArguments(arguments,"between",2);this.validateArgumentsNumeric(this.argsWithoutFirst(arguments),"between");if(+this.get(a)<+arguments[1]||+this.get(a)>+arguments[2]){return getMessage("messages","between").replace(":arg1",arguments[1]).replace(":arg2",arguments[2])}},betweenLength:function(a){this.validateArguments(arguments,"betweenLength",2);this.validateArgumentsNumeric(this.argsWithoutFirst(arguments),"between");if(this.get(a).toString().length<+arguments[1]||this.get(a).toString().length>+arguments[2]){return getMessage("messages","betweenLength").replace(":arg1",arguments[1]).replace(":arg2",arguments[2])}},length:function(a,b){this.validateArguments(arguments,"length");if(this.get(a).toString().length!==+arguments[1]){return getMessage("messages","length").replace(":arg1",arguments[1])}},exists:function(field,collection_name,collection_field){var collection="window.collections."+collection_name;this.collectionDefined(collection);var value=this.get(field);var real_collection=eval(collection);var results=eval("real_collection.where({"+collection_field+": value})");if(results.length==0){return getMessage("messages","exists").replace(":value",value).replace(":field",getMessage("fields",field)).replace(":collection",getMessage("fields",collection_name))}},unique:function(field,collection_name,collection_field,except){var collection="window.collections."+collection_name;this.collectionDefined(collection);var value=this.get(field);var real_collection=eval(collection);var results=eval("real_collection.where({"+collection_field+": value})");if(results.length>0){if(except!=undefined){except=parseInt(except);if(typeof except!=="number"){throw new SyntaxError(getMessage("validations","except_format"))}else{if(results[0].id===except){return}}}return getMessage("messages","unique").replace(":value",value).replace(":field",getMessage("fields",field)).replace(":collection",getMessage("fields",collection_name))}},confirmed:function(a){this.fieldDefined(a);this.fieldDefined(a+"_confirmation");var b=this.get(a);var c=a+"_confirmation";var d=this.get(c);if(b!==d){return getMessage("messages","confirmed")}},same:function(a,b){this.fieldDefined(a);this.fieldDefined(b);if(this.get(a)!=this.get(b)){return getMessage("messages","same").replace(":field",getMessage("fields",a)).replace(":field_eq",getMessage("fields",b))}},different:function(a,b){this.fieldDefined(a);this.fieldDefined(b);if(this.get(a)==this.get(b)){return getMessage("messages","different").replace(":field",getMessage("fields",a)).replace(":field_eq",getMessage("fields",b))}},"boolean":function(a){if(typeof this.get(a)!=="boolean"){return getMessage("messages","boolean")}},email:function(a){if(!emailValid(this.get(a))){return getMessage("messages","email")}},mimes:function(a){this.validateArguments(arguments,"mimes");var b=this.argsWithoutFirst(arguments);var c=this.get(a).indexOf("/")+1;var d=this.get(a).indexOf(";");var e=this.get(a).substring(c,d);if(b.indexOf(e)===-1){return getMessage("messages","mimes")}},date:function(a){if(isNaN(Date.parse(this.get(a)))){return getMessage("messages","date")}},after:function(a,b){var c=Date.parse(this.get(a));var d=parseInt(b);var e=Date.parse(b);if(isNaN(parseInt(e))){throw getMessage("validations","invalid_date").replace(":function","after")}if(isNaN(c)||c<=e){return getMessage("messages","after").replace(":arg1",b)}},before:function(a,b){var c=Date.parse(this.get(a));var d=parseInt(b);var e=Date.parse(b);if(isNaN(parseInt(e))){throw getMessage("validations","invalid_date").replace(":function","after")}if(isNaN(c)||c>=e){return getMessage("messages","before").replace(":arg1",b)}},argsToArray:function(a){var b=new Array;for(i in a){b.push(a[i])}return b},argsWithoutFirst:function(a){var b=this.argsToArray(a);return b.slice(1,b.length)},validateArguments:function(a,b,c){if(a.length<2||a.length==2&&a[1]==""){throw new SyntaxError(getMessage("validations","required_arg").replace(":function",b))}if(c!==undefined){if(a.length-1<c){throw new SyntaxError(getMessage("validations","required_args").replace(":function",b).replace(":num",c))}}},validateArgumentsNumeric:function(a,b){for(i in a){if(typeof parseInt(a[i])!=="number"||isNaN(parseInt(a[i]))){throw new SyntaxError(getMessage("validations","numeric_args").replace(":function",b))}}},fieldDefined:function(a){var b=getMessage("fields",a);if(this.get(a)==undefined){throw getMessage("validations","invalid_field").replace(":field",b==undefined?a+":not_in_lang":b)}},collectionDefined:function(collection){if(eval(collection)==undefined){throw getMessage("validations","invalid_collection").replace(":collection",collection_name)}}});