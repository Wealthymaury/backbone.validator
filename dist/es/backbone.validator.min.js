/* 
 * Backbone Validator v0.5 
 * 
 * por: Mauricio Manjarrez Magallón, @wealthymaury 
 * Minified on Sat Aug 29 2015 10:31:46 
 */
window.Validator={},Validator.Lang={},Validator.Config={debug:!1,lang:"es-mx"};try{_,Backbone}catch(error){throw new Error(error.message)}Validator.Lang["es-mx"]={fields:{},messages:{required:"El campo es requerido.",string:"El campo debe ser un texto.","boolean":"El campo debe ser verdadero o falso.",integer:"El campo debe ser un número.","in":"El campo debe estar en: :arg1.",not_in:"El campo :field no debe estar en: :arg1.",array:"El campo debe ser un arreglo.",min:"El campo debe ser mayor o igual a: :arg1.",minLength:"El campo debe tener una longitud mayor o igual a: :arg1.",max:"El campo debe ser menor o igual a: :arg1.",maxLength:"El campo debe tener una longitud menor o igual a: :arg1.",between:"El campo debe estar entre: :arg1 y :arg2.",betweenLength:"El campo debe tener una longitud entre: :arg1 y :arg2 caracteres.",length:"El campo debe tener una longitud igual a: :arg1.",same:"El campo :field debe ser igual al campo :field_eq.",different:"El campo :field debe ser diferente al campo :field_eq.",confirmed:"El campo debe ser confirmado correctamente.",exists:"El :field :value no existe en el registro de :collection.",unique:"El :field :value ya existe en el registro de :collection.",email:"El campo debe ser un email válido.",mimes:"El formato del archivo es inválido.",regex:"El formato del campo no es válido.",date:"El formato del campo no es válido, debe ser una fecha.",before:"La fecha debe ser anterior a :arg1.",after:"La fecha debe ser posterior a :arg1."},info:{start_validation:"Inicio de la validación para: ",end_validation:"Fin de la validacion para: ",validated:"Se validó: ",result:"Resultado: ",success:"Correcto."},validations:{invalid_field:"El campo :field no esta definido en el modelo.",invalid_collection:"La coleccion :collection no esta definida.",numeric_args:":function : Los argumentos deben ser numericos.",required_arg:":function : debes pasar al menos un parametro a la validación].",required_args:":function : debes pasar :num parametros a la validación.",invalid_rule:"La regla :rule no está definida.",except_format:"El atributo except en la regla Unique debe ser un Identificador.",invalid_date:":function : El argumento deben ser una fecha."}};var info=function(a){1==Validator.Config.debug&&console.info(a)},emailValid=function(a){return expr=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,expr.test(a)?!0:!1},getMessage=function(a,b){b=b.toString();var c=Validator.Config.lang,d=Validator.Lang[c][a][b];return-1!=b.indexOf("id")&&void 0==d&&(d="Identificador"),void 0==d&&(d=b.substr(0,1).toUpperCase()+b.substr(1)),d},arrayStringsToInts=function(a){for(var b=0;b<a.length;b++)a[b]=+a[b];return a};_.extend(Backbone.Model.prototype,{validate:function(a,b){if(1==this.validation){var c={},d={},e=_.map(this.validatorRules,this.makeValidation,this);if("function"==typeof this.moreValidations&&(d=this.moreValidations()),!_.isEmpty(e))for(var f=0;f<=e.length;f++)_.extend(c,e[f]);if(void 0!==d&&_.each(d,function(a,b,c){if(this.hasOwnProperty(b))for(f in a)this[b].push(a[f]);else this[b]=a},c),!_.isEmpty(c))return info("Errores al validar: "+JSON.stringify(c)),c}},makeValidation:function(rules,field_r,list){if(""!=rules){var errors={},arrRules=rules.split("|"),field="'"+field_r+"'";for(i in arrRules){var rule=arrRules[i],parts=rule.split(":");if("undefined"==typeof eval("this."+parts[0]))throw new SyntaxError(getMessage("validations","invalid_rule").replace(":rule",parts[0]));var expBase=parts[0]+"(*);",args="";void 0!==parts[1]&&(parts[1]=parts[1].replace(/,/gi,"','"),args=",'"+parts[1]+"'"),args=args.replace(",''",""),expBase=expBase.replace("*",field+args);var exp="this."+expBase,error=eval(exp);void 0!==error&&(errors[field_r]=errors[field_r]||new Array,errors[field_r].push(error))}return errors}},required:function(a){return""===this.get(a)||null===this.get(a)||void 0===this.get(a)?getMessage("messages","required"):void 0},string:function(a){return"string"!=typeof this.get(a)?getMessage("messages","string"):void 0},integer:function(a){return"number"!=typeof this.get(a)?getMessage("messages","integer"):void 0},"in":function(a){this.validateArguments(arguments,"in");var b=this.get(a),c=this.argsWithoutFirst(arguments),d=c.indexOf(b+"");return-1===d?getMessage("messages","in").replace(":arg1",c.toString().replace(",",", ")):void 0},not_in:function(a){this.validateArguments(arguments,"not_in");var b=this.get(a),c=this.argsWithoutFirst(arguments),d=c.indexOf(b+"");return-1!==d?getMessage("messages","not_in").replace(":arg1",c.toString().replace(",",", ")):void 0},array:function(a){return this.get(a)instanceof Array==0?getMessage("messages","array"):void 0},min:function(a){return this.validateArguments(arguments,"min"),this.validateArgumentsNumeric(this.argsWithoutFirst(arguments),"min"),"number"!=typeof this.get(a)||+this.get(a)<+arguments[1]?getMessage("messages","min").replace(":arg1",arguments[1]):void 0},minLength:function(a){return this.validateArguments(arguments,"minLength"),this.get(a).toString().length<+arguments[1]?getMessage("messages","minLength").replace(":arg1",arguments[1]):void 0},max:function(a){return this.validateArguments(arguments,"max"),this.validateArgumentsNumeric(this.argsWithoutFirst(arguments),"max"),"number"!=typeof this.get(a)||+this.get(a)>+arguments[1]?getMessage("messages","max").replace(":arg1",arguments[1]):void 0},maxLength:function(a){return this.validateArguments(arguments,"maxLength"),this.get(a).toString().length>+arguments[1]?getMessage("messages","maxLength").replace(":arg1",arguments[1]):void 0},between:function(a){return this.validateArguments(arguments,"between",2),this.validateArgumentsNumeric(this.argsWithoutFirst(arguments),"between"),+this.get(a)<+arguments[1]||+this.get(a)>+arguments[2]?getMessage("messages","between").replace(":arg1",arguments[1]).replace(":arg2",arguments[2]):void 0},betweenLength:function(a){return this.validateArguments(arguments,"betweenLength",2),this.validateArgumentsNumeric(this.argsWithoutFirst(arguments),"between"),this.get(a).toString().length<+arguments[1]||this.get(a).toString().length>+arguments[2]?getMessage("messages","betweenLength").replace(":arg1",arguments[1]).replace(":arg2",arguments[2]):void 0},length:function(a,b){return this.validateArguments(arguments,"length"),this.get(a).toString().length!==+arguments[1]?getMessage("messages","length").replace(":arg1",arguments[1]):void 0},exists:function(field,collection_name,collection_field){var collection="window.collections."+collection_name;this.collectionDefined(collection);var value=this.get(field),real_collection=eval(collection),results=eval("real_collection.where({"+collection_field+": value})");return 0==results.length?getMessage("messages","exists").replace(":value",value).replace(":field",getMessage("fields",field)).replace(":collection",getMessage("fields",collection_name)):void 0},unique:function(field,collection_name,collection_field,except){var collection="window.collections."+collection_name;this.collectionDefined(collection);var value=this.get(field),real_collection=eval(collection),results=eval("real_collection.where({"+collection_field+": value})");if(results.length>0){if(void 0!=except){if(except=parseInt(except),"number"!=typeof except)throw new SyntaxError(getMessage("validations","except_format"));if(results[0].id===except)return}return getMessage("messages","unique").replace(":value",value).replace(":field",getMessage("fields",field)).replace(":collection",getMessage("fields",collection_name))}},confirmed:function(a){this.fieldDefined(a),this.fieldDefined(a+"_confirmation");var b=this.get(a),c=a+"_confirmation",d=this.get(c);return b!==d?getMessage("messages","confirmed"):void 0},same:function(a,b){return this.fieldDefined(a),this.fieldDefined(b),this.get(a)!=this.get(b)?getMessage("messages","same").replace(":field",getMessage("fields",a)).replace(":field_eq",getMessage("fields",b)):void 0},different:function(a,b){return this.fieldDefined(a),this.fieldDefined(b),this.get(a)==this.get(b)?getMessage("messages","different").replace(":field",getMessage("fields",a)).replace(":field_eq",getMessage("fields",b)):void 0},"boolean":function(a){return"boolean"!=typeof this.get(a)?getMessage("messages","boolean"):void 0},email:function(a){return emailValid(this.get(a))?void 0:getMessage("messages","email")},mimes:function(a){this.validateArguments(arguments,"mimes");var b=this.argsWithoutFirst(arguments),c=this.get(a).indexOf("/")+1,d=this.get(a).indexOf(";"),e=this.get(a).substring(c,d);return-1===b.indexOf(e)?getMessage("messages","mimes"):void 0},date:function(a){return isNaN(Date.parse(this.get(a)))?getMessage("messages","date"):void 0},after:function(a,b){var c=Date.parse(this.get(a)),d=(parseInt(b),Date.parse(b));if(isNaN(parseInt(d)))throw getMessage("validations","invalid_date").replace(":function","after");return isNaN(c)||d>=c?getMessage("messages","after").replace(":arg1",b):void 0},before:function(a,b){var c=Date.parse(this.get(a)),d=(parseInt(b),Date.parse(b));if(isNaN(parseInt(d)))throw getMessage("validations","invalid_date").replace(":function","after");return isNaN(c)||c>=d?getMessage("messages","before").replace(":arg1",b):void 0},argsToArray:function(a){var b=new Array;for(i in a)b.push(a[i]);return b},argsWithoutFirst:function(a){var b=this.argsToArray(a);return b.slice(1,b.length)},validateArguments:function(a,b,c){if(a.length<2||2==a.length&&""==a[1])throw new SyntaxError(getMessage("validations","required_arg").replace(":function",b));if(void 0!==c&&a.length-1<c)throw new SyntaxError(getMessage("validations","required_args").replace(":function",b).replace(":num",c))},validateArgumentsNumeric:function(a,b){for(i in a)if("number"!=typeof parseInt(a[i])||isNaN(parseInt(a[i])))throw new SyntaxError(getMessage("validations","numeric_args").replace(":function",b))},fieldDefined:function(a){var b=getMessage("fields",a);if(void 0==this.get(a))throw getMessage("validations","invalid_field").replace(":field",void 0==b?a+":not_in_lang":b)},collectionDefined:function(collection){if(void 0==eval(collection))throw getMessage("validations","invalid_collection").replace(":collection",collection_name)}});